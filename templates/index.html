<!doctype html>
<html lang="nl">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>DL sporttools</title>
    <link rel="stylesheet" href="/static/style.css" />
  </head>
  <body>
    <!-- HERO -->
    <section class="hero">
      <img src="/static/img/hero.jpg" alt="" class="hero__img" />
      <img src="/static/img/logo.png" alt="DL/MHNL" class="hero__logo" />
      <div class="hero__overlay">
        <h1>Maak snel je Cue-exports</h1>
        <p>Gebruik deze tools om exports te maken voor Cue Print en Cue Web.</p>
      </div>
    </section>

    <main class="container">
      <!-- BLOKKEN -->
      <section class="card-grid">
<section class="card">
        <div class="card__head">
          <h3>Amateurvoetbal: Excel &gt; Cue Print</h3>
          <p>Upload het ingevulde Excelbestand (.xlsx) met de uitslagen. Klik daarna op de knop hieronder. Je krijgt dan een txt-bestand dat je in Cue Print (Codefixer) moet plakken.</p>
        </div>

        <form action="/convert/amateur" method="post" enctype="multipart/form-data"
              class="upload js-convert"
              data-target="amateur-output"
              data-filename="cue_export_amateur.txt">
          <label class="file btn-like" data-filepicker>
            <input type="file" name="file_amateur" accept=".xlsx" required />
            <span class="file__label">Bestand kiezen</span>
          </label>
          <button type="submit" class="btn btn-primary btn-like">Maak CUE export (.txt)</button>
        </form>

        <!-- verborgen opslag voor gekeerde tekst -->
        <textarea id="amateur-output" class="visually-hidden" aria-hidden="true"></textarea>

        <div class="actions actions--bottom">
          <a class="btn btn-outline" href="/static/docs/AMA_uitslagen_amateuvoetbal_2025-2026_met_BEKER.xlsx" download>
            Download leeg invoerdocument
          </a>
          <button class="btn btn-outline copy-btn" data-target="amateur-output">
            Kopieer direct de code
          </button>
        </div>
        </section>

        
<section class="card">
          <div class="card__head">
            <h3>Amateurvoetbal: Cue Print &gt; Cue Web</h3>
            <p>Upload hier het tekstbestand met Cue Print-code met daarin de uitslagen. Je krijgt dan een Word-document waarvan je de inhoud direct als tekst in Cue Web kunt plakken.</p>
          </div>

          <form action="/convert/amateur-online" method="post" enctype="multipart/form-data"
                class="upload js-convert"
                data-target="amateur-online-output"
                data-filename="cue_word_export_amateur.docx">
            <label class="file btn-like" data-filepicker>
              <input type="file" name="file_amateur_online" accept=".txt" required />
              <span class="file__label">Bestand kiezen</span>
            </label>
            <button type="submit" class="btn btn-primary btn-like">Maak Word export</button>
          </form>

          <textarea id="amateur-online-output" class="visually-hidden" aria-hidden="true"></textarea>

            <p class="hint hint--center">
             Tekst kopiëren: open het gedownloade Word-document, druk Ctrl+A en daarna Ctrl+C. Ga naar je artikel in Cue Web en plak de tekst in de broodtekst met Ctrl+V.
            </p>
          </div>
</section>
      
<section class="card">
        <div class="card__head">
          <h3>Regiosport: Excel &gt; Cue Print</h3>
        <p>Upload het ingevulde Excelbestand (.xlsx). Klik daarna op de knop hieronder. Je krijgt dan een txt-bestand dat je in Cue Print (Codefixer) moet plakken.</p>
        </div>

        <form action="/convert/regiosport" method="post" enctype="multipart/form-data"
              class="upload js-convert"
              data-target="regiosport-output"
              data-filename="cue_export_regiosport.txt">
          <label class="file btn-like" data-filepicker>
            <input type="file" name="file_regio" accept=".xlsx" required />
            <span class="file__label">Bestand kiezen</span>
          </label>
          <button type="submit" class="btn btn-primary btn-like">Maak CUE export (.txt)</button>
        </form>

        <textarea id="regiosport-output" class="visually-hidden" aria-hidden="true"></textarea>

        <div class="actions actions--bottom">
          <a class="btn btn-outline" href="/static/docs/REG_uitslagen_regiosport_2025-2026.xlsx" download>
            Download leeg invoerdocument
          </a>
          <button class="btn btn-outline copy-btn" data-target="regiosport-output">
            Kopieer direct de code
          </button>
        </div>
      </section>

      

        
        <section class="card">
          <div class="card__head">
            <h3>Amateurvoetbal: topscorers &gt; Cue Web</h3>
            <p>Upload hier het tekstbestand (Word of Kladblok) met de topscorers. Je krijgt dan een Word-document waarvan je de inhoud direct als tekst in Cue Web kunt plakken.</p>
          </div>

          <form action="/convert/topscorers" method="post" enctype="multipart/form-data"
                class="upload js-convert"
                data-target="topscorers-output"
                data-filename="cue_word_export_topscorers.docx">
            <label class="file btn-like" data-filepicker>
              <input type="file" name="file_topscorers" accept=".txt,.docx" required />
              <span class="file__label">Bestand kiezen</span>
            </label>
            <button type="submit" class="btn btn-primary btn-like">Maak Word export</button>
          </form>

          <textarea id="topscorers-output" class="visually-hidden" aria-hidden="true"></textarea>

          <p class="hint hint--center">
            Tekst kopiëren: open het gedownloade Word-document, druk Ctrl+A en daarna Ctrl+C. Ga naar je artikel in Cue Web en plak de tekst in de broodtekst met Ctrl+V.
          </p>
        </section>


      </section>

<footer>&copy; DL/MHNL 2025</footer>
    </main>

    <script>
      // Haal bestandsnaam uit Content-Disposition (server) voor dynamische naamgeving
      function filenameFromContentDisposition(res){
        const cd = res.headers.get('Content-Disposition') || res.headers.get('content-disposition');
        if (!cd) return null;

        // RFC 5987 / RFC 6266: filename*=UTF-8''...
        const star = cd.match(/filename\*\s*=\s*UTF-8''([^;]+)/i);
        if (star && star[1]){
          try { return decodeURIComponent(star[1]); } catch(e) { return star[1]; }
        }

        // fallback: filename="..."
        const basic = cd.match(/filename\s*=\s*"([^"]+)"/i);
        if (basic && basic[1]) return basic[1];

        return null;
      }

      function yyyymmddAmsterdam(){
        const now = new Date();
        const parts = new Intl.DateTimeFormat('nl-NL', {
          timeZone: 'Europe/Amsterdam',
          year: 'numeric',
          month: '2-digit',
          day: '2-digit'
        }).formatToParts(now);

        const y = parts.find(p => p.type === 'year')?.value || '1970';
        const m = parts.find(p => p.type === 'month')?.value || '01';
        const d = parts.find(p => p.type === 'day')?.value || '01';
        return `${y}${m}${d}`;
      }

      function fallbackFilenameForAction(action){
        // Fallback als Content-Disposition ontbreekt.
        // Let op: form.action is meestal een absolute URL; pak daarom pathname.
        let path = action;
        try { path = new URL(action).pathname; } catch(e) {}

        const date = yyyymmddAmsterdam();
        const map = {
          '/convert/amateur': `${date}_cue_print_uitslagen_amateurs.txt`,
          '/convert/amateur-online': `${date}_cue_word_uitslagen_amateurs.docx`,
          '/convert/regiosport': `${date}_cue_print_uitslagen_regiosport.txt`,
          '/convert/topscorers': `${date}_cue_word_topscorers_amateurs.docx`,
        };
        return map[path] || null;
      }

      function isDocxResponse(res){
        const ct = (res.headers.get('Content-Type') || '').toLowerCase();
        return ct.includes('application/vnd.openxmlformats-officedocument.wordprocessingml.document');
      }

      function downloadBlob(blob, filename){
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = filename || 'export';
        document.body.appendChild(a);
        a.click();
        a.remove();
        setTimeout(() => URL.revokeObjectURL(url), 1000);
      }

      async function handleConvertForm(form){
        const targetId = form.getAttribute('data-target');
        const target = targetId ? document.getElementById(targetId) : null;
        if (target) target.value = '';

        const fd = new FormData(form);
        const res = await fetch(form.action, { method: 'POST', body: fd });

        if (!res.ok){
          const msg = await res.text();
          alert(msg || 'Converteren is mislukt.');
          return;
        }

        const fname = filenameFromContentDisposition(res) || fallbackFilenameForAction(form.action) || form.getAttribute('data-filename') || 'export';

        if (isDocxResponse(res)){
          const blob = await res.blob();
          downloadBlob(blob, fname);
          return;
        }

        const text = await res.text();
        if (target) target.value = text;

        // Automatisch downloaden als tekst (voor txt converters)
        const blob = new Blob([text], { type: 'text/plain;charset=utf-8' });
        downloadBlob(blob, fname);
      }

      document.querySelectorAll('form.js-convert').forEach(form => {
        form.addEventListener('submit', (e) => {
          e.preventDefault();
          handleConvertForm(form);
        });
      });

      // "Bestand kiezen" label updaten
      document.querySelectorAll('[data-filepicker] input[type=file]').forEach(inp => {
        const label = inp.closest('[data-filepicker]')?.querySelector('.file__label');
        inp.addEventListener('change', () => {
          if (!label) return;
          label.textContent = inp.files && inp.files[0] ? inp.files[0].name : 'Bestand kiezen';
        });
      });

      // Copy-knoppen
      document.querySelectorAll('.copy-btn').forEach(btn => {
        btn.addEventListener('click', async () => {
          const targetId = btn.getAttribute('data-target');
          const ta = targetId ? document.getElementById(targetId) : null;
          if (!ta) return;
          try{
            await navigator.clipboard.writeText(ta.value || '');
            alert('Gekopieerd.');
          } catch(e){
            ta.select();
            document.execCommand('copy');
            alert('Gekopieerd.');
          }
        });
      });
    </script>
  </body>
</html>
